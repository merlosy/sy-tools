"use strict";angular.module("sy-tools",["sy-tools.birthdate","sy-tools.browser","sy-tools.feedback","sy-tools.validation"]),angular.module("sy-tools.birthdate",[]).constant("BIRTHDATE",{lang:{placeholder_day:"DD",placeholder_month:"MM",placeholder_year:"YYYY",title_day:"Day of birth",title_month:"Month of birth",title_year:"Year of birth"},separator:"/"}).directive("birthdate",["$log","$timeout","BIRTHDATE",function(a,b,c){var d=function(a){return angular.isUndefined(a)||null===a||""===a};return{restrict:"E",require:"ngModel",replace:!0,transclude:!0,templateUrl:"app/utils/birthdate.template.html",scope:{dateValue:"=ngModel"},link:function(a,b,e,f){a.init=!0,a.lang=c.lang,a.setDateFromFields=function(){a.init=!1,a.day=angular.isDefined(a.day)?a.day.replace(/[^0-9]/g,""):"",a.month=angular.isDefined(a.month)?a.month.replace(/[^0-9]/g,""):"",a.year=angular.isDefined(a.year)?a.year.replace(/[^0-9]/g,""):"",a.dateValue=a.day+c.separator+a.month+c.separator+a.year};var g=function(b){if(b){var d=b.split(c.separator);a.day=d[0],a.month=d[1],a.year=d[2]}else a.day="",a.month="",a.year=""};g(a.dateValue),a.$watch("day",function(c,e){if(!d(c)||c!==e){var f=b.find("input");d(c)||2!==c.length||a.init||(f[1].focus(),f[1].select())}}),a.$watch("month",function(c,e){if(c||c!==e){var f=b.find("input");d(c)||2!==c.length||a.init||(f[2].focus(),f[2].select())}}),a.$watch("dateValue",function(a,b){a&&a!==b&&g(a)})}}}]),angular.module("sy-tools.browser",[]).constant("DEVICES",{ANDROID:"android",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",BLACKBERRY:"blackberry",FIREFOXOS:"firefoxos",WINDOWSPHONE:"windows-phone",PS4:"ps4",VITA:"vita",UNKNOWN:"unknown"}).constant("OS",{WINDOWS:"windows",MAC:"mac",IOS:"ios",ANDROID:"android",LINUX:"linux",UNIX:"unix",FIREFOXOS:"firefoxos",WINDOWSPHONE:"windows-phone",PS4:"ps4",VITA:"vita",UNKNOWN:"unknown"}).constant("BROWSERS",{CHROME:{name:"chrome",pattern:"Chrome",min_version:36},FIREFOX:{name:"firefox",pattern:"Firefox",min_version:30},SAFARI:{name:"safari",pattern:"Safari",min_version:536},OPERA:{name:"opera",pattern:"Opera"},IE:{name:"IE",pattern:"MSIE",min_version:9},IE11:{name:"IE-trident",pattern:"Trident",min_version:5},PS4:{name:"ps4",pattern:"Mozilla 5.0 (PlayStation 4"},VITA:{name:"vita",pattern:"Mozilla 5.0 (PlayStation Vita"},UNKNOWN:{name:"unknown",pattern:"unknown"}}).factory("Device",["$window","DEVICES","BROWSERS","OS",function(a,b,c,d){var e=a.navigator.userAgent,f=function(){this.userAgent=e,this.raw={os:{},browser:{},device:{}},this.browser={name:null,version:null},this.raw.os[d.WINDOWS]=/\bWindows\b/.test(e)&&!/\bWindows Phone\b/.test(e),this.raw.os[d.MAC]=/\bMac OS\b/.test(e),this.raw.os[d.IOS]=/\biPad\b/.test(e)||/\biPhone\b/.test(e)||/\biPod\b/.test(e),this.raw.os[d.ANDROID]=/\bAndroid\b/.test(e),this.raw.os[d.LINUX]=/\bLinux\b/.test(e),this.raw.os[d.UNIX]=/\bUNIX\b/.test(e),this.raw.os[d.FIREFOXOS]=/\bFirefox\b/.test(e)&&/\Mobile\b/.test(e),this.raw.os[d.WINDOWSPHONE]=/\bIEMobile\b/.test(e),this.raw.os[d.PS4]=/\bMozilla\/5.0 \(PlayStation 4\b/.test(e),this.raw.os[d.VITA]=/\bMozilla\/5.0 \(Play(S|s)tation Vita\b/.test(e),this.raw.browser[c.CHROME.name]=/\bChrome\b/.test(e)||/\bCriOS\b/.test(e),this.raw.browser[c.FIREFOX.name]=/\Firefox\b/.test(e),this.raw.browser[c.SAFARI.name]=/^((?!CriOS).)*\Safari\b.*$/.test(e)&&!/\bChrome\b/.test(e),this.raw.browser[c.OPERA.name]=/\Opera\b/.test(e),this.raw.browser[c.IE.name]=/\bMSIE\b/.test(e)||/\Trident\b/.test(e),this.raw.browser[c.PS4.name]=/\bMozilla\/5.0 \(PlayStation 4\b/.test(e),this.raw.browser[c.VITA.name]=/\bMozilla\/5.0 \(Play(S|s)tation Vita\b/.test(e),this.raw.device[b.ANDROID]=/\bAndroid\b/.test(e),this.raw.device[b.IPAD]=/\biPad\b/.test(e),this.raw.device[b.IPHONE]=/\biPhone\b/.test(e),this.raw.device[b.IPOD]=/\biPod\b/.test(e),this.raw.device[b.BLACKBERRY]=/\bblackberry\b/.test(e),this.raw.device[b.FIREFOXOS]=/\bFirefox\b/.test(e)&&/\Mobile\b/.test(e),this.raw.device[b.WINDOWSPHONE]=/\bIEMobile\b/.test(e),this.raw.device[b.PS4]=/\bMozilla\/5.0 \(PlayStation 4\b/.test(e),this.raw.device[b.VITA]=/\bMozilla\/5.0 \(Play(S|s)tation Vita\b/.test(e);var a=new Array,f=this.raw.os;for(var g in d)a.push(d[g]);this.os=a.reduce(function(a,b){return a===d.UNKNOWN&&f[b]?b:a},d.UNKNOWN);var h=new Array,i=this.raw.browser;for(var g in c)h.push(c[g].name);this.browser.name=h.reduce(function(a,b){return a===c.UNKNOWN.name&&i[b]?b:a},c.UNKNOWN.name);var j=new Array,k=this.raw.device;for(var g in b)j.push(b[g]);this.device=j.reduce(function(a,c){return a===b.UNKNOWN&&k[c]?c:a},b.UNKNOWN);var l=c.UNKNOWN;for(var g in c)c[g].name===this.browser.name&&(l=c[g]);var m=e.substr(e.indexOf(l.pattern)+l.pattern.length).match(/\d+(\.\d+)?/);this.browser.version=m.length>0?m[0]:"",angular.isDefined(l.min_version)?this.isSupported=l.min_version<=parseFloat(this.browser.version):this.isSupported=!1};return f.prototype.isMobile=function(){return this.device!==b.UNKNOWN},f.prototype.isAndroid=function(){return this.device===b.ANDROID||this.OS===d.ANDROID},f.prototype.isIOS=function(){return this.os===d.IOS||this.device===b.IPOD||this.device===b.IPHONE},f}]).directive("deviceDetector",["Device","$log","$window","$sce","$rootScope",function(a,b,c,d,e){return{restrict:"E",replace:!0,template:'<div ng-show="!device.isSupported" class="alert alert-warning" role="alert" ng-bind-html="texte"></div>',link:function(c,e,f){c.device=new a,b.debug(c.device),c.content=JSON.stringify(c.device),c.texte=d.trustAsHtml("The browser is not supported by this application."),e.addClass("os-"+c.device.os),e.addClass("browser-"+c.device.browser.name),e.addClass("device-"+c.device.device)}}}]),angular.module("sy-tools.feedback",[]).constant("FEEDBACK",{unavailable:"The server is currently unavailable. Please, try again later.",failure:"An error has occured. Please, contact support or try again later.",level:{"default":"default",success:"success",info:"info",warning:"warning",danger:"danger"}}).constant("HTTP_CODE",{pattern_4XX:/^4[0-9]{2}$/}).directive("syFeedback",["$log","Feedback",function(a,b){return{restrict:"E",replace:!0,template:'<div class="alert alert-{{alert.level}} alert-dismissible" role="alert" ng-repeat="alert in feedback.alerts"> 	<button ng-show="alert.closable" type="button" class="close" title="{{lang.actions.fermer.titre}}" data-dismiss="alert" ng-click="closeAlert($index)"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button> 		{{alert.message}} 		<ul ng-show="alert.array">  			<li ng-repeat="message in alert.array track by $index" ng-show="message.length>0">{{message}}</li> 		</ul> 	</div>',scope:{feedback:"=model"},link:function(a,b,c,d){a.closeAlert=function(b){a.feedback.alerts.splice(b,1)}}}}]).factory("Feedback",["$rootScope","$timeout","$log","HTTP_CODE","FEEDBACK",function(a,b,c,d,e){var f=function(a){return angular.isUndefined(a)||null===a||""===a},g=function(a,b){return JSON.stringify(a)===JSON.stringify(b)},h=function(a,b,c){var d={level:b||e.level["default"],closable:angular.isDefined(c)?c:!0};if(angular.isArray(a))switch(a.length){case 0:d.message=e.failure;break;case 1:d.message=a[0];break;default:d.array=a}else d.message=f(a)?e.failure:a;return d},i=function(a,b){var d=!1;for(var e in a)(angular.isDefined(b.message)&&a[e].message===b.message&&a[e].level===b.level||angular.isArray(b.array)&&g(a[e].array,b.array)&&a[e].level===b.level)&&(c.debug("Message duplicated"),d=!0);return d},j=function(){this.alerts=new Array};return j.prototype.local=function(a,b,c){var d=h(a,b,c);i(this.alerts,d)||this.alerts.push(d)},j.prototype.validation=function(a){this.local(a,e.level.danger)},j.prototype.error=function(a,b){c.debug(b);var f=new Array;switch(b.status){case 412:if(angular.isDefined(b.data)&&angular.isArray(b.data))for(var g=0;g<b.data.length;g++)if(f.push(b.data[g].message),angular.isDefined(b.data[g].nomParametres)&&angular.isArray(b.data[g].nomParametres))for(var j=0;j<b.data[g].nomParametres.length;j++){var k=b.data[g].nomParametres[j];a[k]={passes:!1}}break;case d.pattern_4XX.test(b.status):f=e.failure;break;case 503:f=e.unavailable}var l=h(f,e.level.danger);i(this.alerts,l)||this.alerts.push(l)},j}]),angular.module("sy-tools.footer",[]).directive("footer",["$log","$window","$timeout",function(a,b,c){return{restrict:"E",link:function(a,d,e,f){function g(){var a=d[0].offsetHeight;d.css("margin-top","-"+a+"px"),angular.element("#page-wrapper > div:first-child").css("padding-bottom",a+"px")}angular.element(b).bind("resize",function(){c(function(){g()})}),g()}}}]),function(){var a=angular.module("sy-tools.password-strength",["ui.bootstrap.progressbar","template/progressbar/progress.html","template/progressbar/progressbar.html"]);a.directive("syPasswordStrength",["$log","$rootScope",function(a,b){return{template:'<progressbar value="value" type="{{type}}" title="Password strength">{{niveau}}</progressbar><div>{{message}}</div>',restrict:"E",replace:!1,scope:{pwd:"=syPassword",value:"=syStrength"},link:function(a){var c="Weak",d=function(a){var b,c,d,e={all:{},consec:{}},f={},g=0,h=null,i={variete:0,consecutif:0,caracteresDifferents:0};if(a){for(c=a.split(""),f.lower=a.match(/[a-z]/g),f.upper=a.match(/[A-Z]/g),f.numbers=a.match(/\d/g),f.symbols=a.match(/[^a-zA-Z0-9_]/g),e.all.lower=f.lower?f.lower.length:0,e.all.upper=f.upper?f.upper.length:0,e.all.numbers=f.numbers?f.numbers.length:0,e.all.symbols=f.symbols?f.symbols.length:0,angular.forEach(e.all,function(a,b){a>0&&this.variete++},i),b=0;b<c.length;b++)d=h==c[b]?d+1:1,h=c[b],i.consecutif=Math.max(d,i.consecutif);var j=new Array,k=0;for(b=0;b<c.length;b++)angular.isUndefined(j[c[b]])&&(j[c[b]]=0),j[c[b]]++,k=Math.max(j[c[b]],k);i.caracteresDifferents=Object.keys(j).length}return Math.max(0,Math.min(100,Math.round(g)))},e=function(a){switch(Math.round(a/33)){case 0:case 1:return"danger";case 2:return"warning";case 3:return"success"}},f=function(a,c){return 0==a?b.lang.jauge.message.taille_nulle:c},g=function(a){switch(Math.round(a/33)){case 0:return b.lang.jauge.niveau.faible;case 1:return b.lang.jauge.niveau.faible;case 2:return b.lang.jauge.niveau.moyen;case 3:return b.lang.jauge.niveau.fort}};a.$watch("pwd",function(b,h){b!==h&&(a.value=d(a.pwd),a.type=e(a.value),a.level=g(a.value),a.message=f(a.value,c))})}}}])}(),function(){var a=angular.module("sy-tools.validation",[]),b=/^\-?\d+$/,c=/^\-?\d+(\,\d+)?$/,d=/^\-?\d+(\.\d+)?$/,e=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/,f=/^[0-9]{5}$/,g=/^[0-9]{6}([aAbB]|[0-9])[0-9]{6}$/,h=/^[0-9A-Za-z]*$/,i=/^[A-Za-zÀÂÄÇÉÈÊËÎÏÔÖÙÛÜŸàâäçéèêëîïôöùûüÿÆŒæœ\-\' ]*$/,j=/^[A-Za-z \-]*$/,k=/^[A-Za-z]*$/,l=/^(\+[1-9]|[0-9]{2})[0-9]{7,13}$/;a.factory("Validation",["$log","$filter",function(a,m){var n=function(a){return angular.isUndefined(a)||null===a||""===a},o=function(o,p){function q(a){return"[object Date]"!==Object.prototype.toString.call(a)?!1:!isNaN(a.getTime())}var r=!1;switch(p.key){case"isTrue":r=1==p.value;break;case"integer":r=n(o)||b.test(o);break;case"nir":r=g.test(o);break;case"tel":r=n(o)||l.test(o);break;case"postcode":r=f.test(o);break;case"alphadashspace":r=j.test(o);break;case"alphanumeric":r=h.test(o);break;case"alphachars":r=i.test(o);break;case"alpha":r=k.test(o);break;case"floatfr":r=c.test(o);break;case"floateng":r=d.test(o);break;case"array":r=angular.isArray(o);break;case"inarray":r=void 0!==o&&p.value.indexOf(o)>-1;break;case"email":r=e.test(o);break;case"date":var s=new Date;if(o instanceof Date)s=o;else if(void 0!==o){var t=o.split("/"),u=parseInt(t[0],10),v=parseInt(t[1],10),w=parseInt(t[2],10);s=new Date(w,v-1,u)}var x=m("date")(s,"dd/MM/yyyy");r=void 0!==o&&q(s)&&x==o;break;case"datebefore":var s=new Date;if(void 0!==o){var t=o.split("/"),u=parseInt(t[0],10),v=parseInt(t[1],10),w=parseInt(t[2],10);s=new Date(w,v-1,u)}r=s<p.value;break;case"boolean":r=void 0!==o&&"boolean"==typeof o;break;case"min":r=parseFloat(o)>=p.value;break;case"max":r=parseFloat(o)<=p.value;break;case"equal":r=o==p.value;break;case"length":r=void 0!==o&&String(o).length==p.value;break;case"minlength":r=void 0!==o&&String(o).length>=p.value;break;case"maxlength":r=void 0==o||String(o).length<=p.value;break;case"required":r=void 0!==o&&""!==o&&null!==o||angular.isArray(o)&&o.length>0||o instanceof Date||"boolean"==typeof o}return a.debug("check for "+o+" as "+p.key+" is "+r),r},p=function(a){var b=new Array;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b=b.concat(d.messages)}return b},q=function(){this.done=!1,this.fields=new Array};return q.prototype.add=function(a,b,c,d){for(var e=!0,f=new Array,g=0;g<c.length;g++){var h=o(b,c[g]);if(e=e&&h,!h&&(void 0!==c[g].message&&""!==c[g].message&&f.push(c[g].message),void 0!==d&&d))break}return this.fields[a]={passes:e,messages:f},this.fields[a]},q.prototype.get=function(a){return this.fields[a]},q.prototype.isValid=function(){var a=!0;for(var b in this.fields)if(this.fields.hasOwnProperty(b)){var c=this.fields[b];a=a&&c.passes}else a=!1;return a},q.prototype.errorsAsString=function(){return p(this.fields).join(" ")},q.prototype.errorsAsArray=function(){return p(this.fields)},q}])}();